#
# ~/.shrc
#
# vim: ft=sh
[ -r "$HOME/.shrc.local" ] && . "$HOME/.shrc.local"

set -o emacs

if [ -n "$BASH" ]
then
    user=`printf '\033[34m%s\033[m' "$LOGNAME"`
    host=`printf '\033[32m\\h\033[m'`
    PS1="$user@$host:\W\$ "
else
    PS1="$LOGNAME@\h:\W\$ "
fi
export PS1

# Turn on ls colors
if type -p dircolors > /dev/null 2>&1
then
    if [ -n "$SOURCE_DIRCOLORS" ]
    then
        eval `dircolors "$HOME/.dir_colors"`
        unset SOURCE_DIRCOLORS
    fi
    alias ls="ls --color=auto"
else
    CLICOLOR=1
    LSCOLORS=ExFxBxDxCxegedabagacad
    export CLICOLOR LSCOLORS
fi

# Colorize others if they exist
COLORIZE_CMDS="pacman grep egrep fgrep"
for cmd in $COLORIZE_CMDS
do
    if type -p $cmd > /dev/null 2>&1
    then
        alias $cmd="$cmd --color=auto"
    fi
done

# Handy Tmux aliases
if type -p tmux > /dev/null 2>&1
then
    alias tas=tmux\ attach-session\ -t
    alias tns=tmux\ new-session\ -s
    alias tls=tmux\ list-sessions
fi

alias export="export -p"

# Configure GPG and start the agent if it isn't already running
if type -p gpg-connect-agent > /dev/null 2>&1
then
    export GPG_TTY=`tty`
    gpg-connect-agent updatestartuptty /bye > /dev/null 2>&1

    # Configure GPG as an SSH key provider
    # Assume SSH agent is forwarded if we're in an SSH session
    if [ -z "$SSH_TTY" ] && type -p gpgconf > /dev/null 2>&1
    then
        unset SSH_AGENT_PID
        if [ "`gpgconf --list-dirs agent-ssh-socket | wc -l`" -eq 1 ]
        then
            export SSH_AUTH_SOCK=`gpgconf --list-dirs agent-ssh-socket`
        fi
    fi
fi

if [ "$VISUAL" == "vi" ]
then
    alias vim=vi
fi

if type -p fortune > /dev/null 2>&1 && [ "$SHLVL" -le 1 -o \( -n "$DISPLAY" -a -z "$SSH_TTY" -a "$SHLVL" -le 2 \) ]
then
    [ -n $NEWLINE ] && echo; unset NEWLINE
    fortune
fi
